<% provide(:title, "Codeology | New Availability") %>

<section class="section">
  <div class="container">
      
    <h3 class="small-vertical-padding has-text-centered">New Availability</h3>
    

    <div class="row">
      <div class="col s12 m10 offset-m1 l8 offset-l2">
        <%= form_tag("/availabilities", method: "post", autocomplete: "off") do %>
          <input autocomplete="off" name="hidden" type="text" style="display:none;">

          <div class="input-field">
            <i class="material-icons prefix">today</i>
            <input type="text" id="availability_date" class="datepicker" name="availability[date]">
            <label for="availability_date">Pick a date</label>
          </div>

          <div class="input-field">
            <i class="material-icons prefix">timer</i>
            <input type="text" id="availability_time" class="timepicker" name="availability[time]">
            <label for="availability_time">Pick a time</label>
          </div>


          <div class="input-field">
            <i class="material-icons prefix">code</i>
            <select id="availability_language" name="availability[is_python]">
              <option value="true">Python</option>
              <option value="false">Java</option>
            </select>
            <label>Language</label>
          </div>
            
          <div class="input-field">
            <i class="material-icons prefix">location_on</i>
            <select id="availability_location" name="availability[is_videocall]">
              <option value="false">On Campus</option>
              <option value="true">Videocall</option>
            </select>
            <label>Location</label>
          </div>

          <div class="input-field">            
            <input type="submit" name="commit" value="Submit" class="btn waves-effect waves-green white black-text is-round normal-caps" 
            data-disable-with="Submit">
          </div>

        <% end %>
      </div>
    </div>
  </div>
</section>

<script type="text/javascript">
/*

  function populate(start)
  {
    $("#availability_time").html(""); //reset child options
    for (i = start; i<32; i++) { //populate child options 
      $("#availability_time").append("<option>"+timeArray[i]+"</option>");
    };
  };

  let tomorrow = new Date();
  tomorrow.setDate(tomorrow.getDate()+1);
  
  let timeArray = ["8:00 am",
                  "8:30 am",
                  "9:00 am",
                  "9:30 am",
                  "10:00 am",
                  "10:30 am",
                  "11:00 am",
                  "11:30 am",
                  "12:00 pm",
                  "12:30 pm",
                  "1:00 pm",
                  "1:30 pm",
                  "2:00 pm",
                  "2:30 pm",
                  "3:00 pm",
                  "3:30 pm",
                  "4:00 pm",
                  "4:30 pm",
                  "5:00 pm",
                  "5:30 pm",
                  "6:00 pm",
                  "6:30 pm",
                  "7:00 pm",
                  "7:30 pm",
                  "8:00 pm",
                  "8:30 pm",
                  "9:00 pm",
                  "9:30 pm",
                  "10:00 pm",
                  "10:30 pm",
                  "11:00 pm",
                  "11:30 pm"]
  $('[data-toggle="datepicker"]').datepicker({
    autoHide: true,
    startDate: tomorrow,
    endDate: new Date(2019, 0, 0)
  }); 

  $("#availability_date").on('pick.datepicker', function (e) {
    if (e.date.getMonth() == tomorrow.getMonth() && e.date.getDate() == tomorrow.getDate()) {
      let today = new Date();
      today.setDate(today.getDate());
      // DAYLIGHT SAVINGS: 15 needs to be changed to 16 when we lose? an hour
      let hours = (today.getHours() + 16 ) % 24;
      let minutes = today.getMinutes();
      // calculate index from current time
      let index = 0;
      if (minutes < 29) {
        index = index + 1;
      } else if (minutes < 59) {
        index = index + 2;
      }
      index = (index + (hours * 2)) % 32;

      // if we're between 12am and 8am, set index to 0
      if (index < 0 || index > 32) {
        index = 0;
      }
      // Fill in options
      populate(index);

    } else {
      // Fill in options
      populate(0);
    }
  });
*/

  function closeMessage() {
    $("#msg").css('display', 'none');
  }
  $(document).ready(function(){
    $('.timepicker').timepicker();
    $('.datepicker').datepicker();
    $('select').formSelect();
  });
</script>